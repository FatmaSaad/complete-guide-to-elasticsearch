1
00:00:02,060 --> 00:00:07,870
今までは､ ドキュメントに集約で使用するフィールドが含まれていることを前提としていました｡ 

2
00:00:07,880 --> 00:00:10,050
しかし､ そうでない場合はどうでしょうか｡ 

3
00:00:10,070 --> 00:00:15,200
ステータス・フィールドで集計しているときに､ このフィールドを持たない文書があったらどうするか？

4
00:00:15,230 --> 00:00:16,880
あるいは､ 値がNULLの場合はどうでしょうか？

5
00:00:17,000 --> 00:00:23,560
これらのドキュメントをmissingという名前のアグリゲーションで集約してから､ その集約がどのようなものかをお見せすることができるのです｡

6
00:00:23,570 --> 00:00:28,820
ステータスフィールドを含まない､ あるいは値を含まないドキュメントがいくつか必要です｡

7
00:00:29,120 --> 00:00:34,460
テストドキュメントに追加するための超簡単なクエリを2つ用意しましたので､ まずはそれを実行してみましょう｡

8
00:00:39,970 --> 00:00:44,560
さて､ テストデータができたので､ 集計がどのようになるかをお見せしましょう｡ 

9
00:00:44,980 --> 00:00:52,540
そこで､ Xキーを追加して､ ステータスのない集計オーダーに名前をつけてみましょう｡ 

10
00:00:53,550 --> 00:00:59,220
そして､ 不足しているSDG集計タイプとフィールドを書き込むと､ ステータスになります｡ 

11
00:01:00,050 --> 00:01:00,790
そして､ それだけです｡ 

12
00:01:00,800 --> 00:01:01,700
走らせてみよう｡ 

13
00:01:02,000 --> 00:01:07,160
missing aggregation はバケット集約なので､ status フィールドを全く持たないか､

14
00:01:07,160 --> 00:01:10,310
値が null の注文でバケットを作成します｡

15
00:01:10,760 --> 00:01:16,100
結果を見ると､ 先ほど追加した2つの文書に限ってそうなっていることがわかる｡

16
00:01:16,550 --> 00:01:19,520
足りない集計は､ 本当にそれだけです｡ 

17
00:01:19,790 --> 00:01:24,110
NULLアンダースコアの値のマッピングパラメータを尊重することは述べておきたい｡ 

18
00:01:24,110 --> 00:01:31,730
フィールドマッピングでそれを使う場合､ 通常､ 欠落した集計を他の集計と組み合わせて使う｡

19
00:01:31,730 --> 00:01:38,630
例えば､ 何らかの指標で集計して､ ステータスのない注文の合計金額を集計することも考えられる｡

20
00:01:39,200 --> 00:01:48,680
ということで､ ご存知の通り､ サブアグリゲーションを追加して､ someが足りないので､ ここにsomeとtotal amountをフィールドとして指定して実行するだけで､

21
00:01:48,680 --> 00:01:53,360
簡単にできるようになります｡

22
00:01:53,840 --> 00:01:58,790
そして､ 見ての通り､ ステータスフィールドのない注文の合計金額は300です｡ 

23
00:01:59,150 --> 00:02:04,250
もちろん､ 必ずしも欠落した集計を他の集計と組み合わせる必要はない｡ 

24
00:02:04,280 --> 00:02:08,210
無効な注文を見つけたりすること自体も有効です｡ 

25
00:02:08,810 --> 00:02:14,570
いずれにせよ､ この講義をまとめる前に､ 2つのテスト注文を削除したいので､

26
00:02:14,570 --> 00:02:24,860
delete or defaults 1001と書いてコピーを作り､ 1002を指定して､ この2つのクエリを実行します｡
