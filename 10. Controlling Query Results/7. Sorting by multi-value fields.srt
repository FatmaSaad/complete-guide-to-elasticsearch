1
00:00:02,460 --> 00:00:10,460
Elasticsearchで結果をソートする基本的な方法がわかったところで､ 今度は複数の値を持つフィールドでソートするクールな方法を紹介します｡

2
00:00:10,470 --> 00:00:18,990
これは､ レシピインデックス内に保存されたドキュメントにある評価フィールドのように､ 複数の値を含むフィールドでソートできることを意味します｡

3
00:00:19,560 --> 00:00:25,500
フィールドはデフォルトで複数の値を含むことができるので､ どのマッピングでもこれを定義していないことを忘れないでください｡ 

4
00:00:25,680 --> 00:00:32,340
この特定のフィールドは float 型で､ 複数値フィールドでソートするための評価値の配列を含んでいます｡ 

5
00:00:32,340 --> 00:00:36,210
ソートモードを指定する必要があり､ 5つの値のうちの1つを指定します｡ 

6
00:00:36,210 --> 00:00:40,260
そのうちの1つを紹介し､ 残りの1つはその後にお話ししましょう｡ 

7
00:00:41,050 --> 00:00:45,940
そこで､ 簡単なクエリをロードして､ それにサドルを適用する準備をしています｡ 

8
00:00:46,120 --> 00:00:54,490
この例では､ エラー評価の最も高いレシピでソートするため､ まずここにオブジェクトを追加します｡

9
00:00:54,670 --> 00:01:01,870
この順序では､ レーティングフィールドでソートしたいので､ このフィールドにオブジェクトを定義します｡ 

10
00:01:02,380 --> 00:01:04,870
順番は降順になります｡ 

11
00:01:05,320 --> 00:01:11,560
まず最高評価を得て､ それからモードを指定できるようにしています｡ 

12
00:01:13,330 --> 00:01:15,850
そこで､ ここで私はいくつかの選択肢を用意しました｡ 

13
00:01:16,090 --> 00:01:18,310
平均値､ 最大値､ 最小値､ 合計値｡ 

14
00:01:18,610 --> 00:01:22,250
これらはすべて､ 後でアグリゲーションについて説明するときに見ることになる｡ 

15
00:01:22,270 --> 00:01:26,470
とりあえず､ エラーの評価が気になるので､ AVGを指定してみます｡ 

16
00:01:28,040 --> 00:01:34,670
そこで､ Elasticsearchがやってくれることは､ 配列内の数値に基づいて平均評価を計算することです｡

17
00:01:35,390 --> 00:01:40,610
これは､ リレーショナル・データベースでおなじみのアグリゲーションと呼ばれるものです｡ 

18
00:01:41,270 --> 00:01:47,060
まだ､ Elasticsearchのアグリゲーションの話には入っていませんが､ 次のセクションで説明します｡

19
00:01:47,090 --> 00:01:53,390
つまり､ ここでやっていることは､ 実はAVGモード以外のアグリゲーションへの近道みたいなものです｡ 

20
00:01:53,390 --> 00:01:55,310
他にもいくつか選択肢を見たんですね｡ 

21
00:01:55,550 --> 00:01:59,930
そこで､ 単純に数字を合計するサブモードも用意しました｡ 

22
00:02:00,380 --> 00:02:02,120
中央値モードもある｡ 

23
00:02:02,210 --> 00:02:06,170
これらのフリーモードは､ 数値を含むフィールドにのみ適用される｡ 

24
00:02:06,650 --> 00:02:11,930
また､ 数値データ型に限らず､ MinとMaxという名前のモードがあります｡ 

25
00:02:12,230 --> 00:02:16,250
これらのモードでは､ それぞれ最低値と最高値を使用してソートします｡ 

26
00:02:16,940 --> 00:02:21,920
先ほど言ったように､ この2つのモードは数字に限らないので､ 日付でも使えます｡ 

27
00:02:22,720 --> 00:02:24,140
ソディングは以上です｡ 

28
00:02:24,160 --> 00:02:26,860
では､ 別の話に移りましょう｡ 
