1
00:00:02,270 --> 00:00:06,380
ここまでは､ 1つのフィールド内の単語を検索しているだけでした｡ 

2
00:00:06,410 --> 00:00:11,240
この講義では､ 同じクエリ内で複数のフィールドを検索する方法を紹介したいと思います｡ 

3
00:00:11,330 --> 00:00:13,610
結論から言うと､ これはとても簡単なことです｡ 

4
00:00:13,610 --> 00:00:16,790
Multi Underscore Matchというクエリを使用することにより｡ 

5
00:00:17,120 --> 00:00:22,460
このクエリでは､ これまで行ったクエリとは別に､ 検索対象となるフィールドの配列を指定することができますので､

6
00:00:22,460 --> 00:00:25,010
その例を見てみましょう｡

7
00:00:25,400 --> 00:00:28,970
つまり､ 先ほど言ったように､ クエリータイプはマルチアンダースコアマッチなのです｡ 

8
00:00:29,660 --> 00:00:32,150
クエリーはパスタになります｡ 

9
00:00:32,980 --> 00:00:35,940
そして､ フィールド名を格納する配列があります｡ 

10
00:00:35,950 --> 00:00:41,350
そこで､ タイトル欄だけでなく､ 説明欄も検索してみることにします｡ 

11
00:00:42,010 --> 00:00:43,960
クエリを実行してみましょう｡ 

12
00:00:44,260 --> 00:00:46,870
ちょっと結果をスクロールしてみましょう｡ 

13
00:00:47,140 --> 00:00:50,920
まず､ タイトルにパスタという言葉が含まれる文書がある｡ 

14
00:00:50,980 --> 00:00:56,830
少し下にスクロールして､ ここにそうでない文書があります｡ 

15
00:00:57,250 --> 00:01:01,180
その代わり､ 本書では説明欄の中にその用語を記載しています｡ 

16
00:01:01,480 --> 00:01:06,250
つまり､ このクエリは､ タイトルと説明の両方のフィールドを検索していることがわかります｡ 

17
00:01:06,850 --> 00:01:12,730
また､ クエリにtypeオプションを追加することで､ クエリの内部実行方法を制御することも可能です｡ 

18
00:01:12,760 --> 00:01:14,520
それが少し高度になるんです｡ 

19
00:01:14,530 --> 00:01:20,020
でも､ 私は今伝えたいので､ デフォルトで起こることをお伝えする以外には触れません｡

20
00:01:20,260 --> 00:01:25,750
タイトルと説明のフィールド内で､ スパゲッティとパスタという言葉を検索しているとします｡ 

21
00:01:26,110 --> 00:01:31,720
2つのフィールドを検索していても､ 2つの用語がそれぞれのフィールドに1つずつ現れるよりも､ 同じフィールドに現れた方が､

22
00:01:31,720 --> 00:01:35,380
ドキュメントの関連性は高くなると思われます｡

23
00:01:35,680 --> 00:01:43,510
デフォルトでは､ 指定したフィールドのいずれかに単語を含む文書が照合されるが､ 最もよく一致するフィールドの関連スコアが使われる｡

24
00:01:43,870 --> 00:01:49,570
つまり､ 一方のフィールドに両方の用語が含まれ､ 他方のフィールドにはどちらか一方しか含まれない場合､

25
00:01:49,570 --> 00:01:53,380
その文書には最初のフィールドの関連スコアが使用されます｡

26
00:01:53,650 --> 00:01:59,380
内部的には､ Elasticsearchがタームを受け取り､ このMaxというクエリ内でそれぞれのタームに対してマッチクエリを実行する､

27
00:01:59,380 --> 00:02:01,450
という流れになっています｡

28
00:02:01,810 --> 00:02:06,580
それはまだ理解することが重要でない高度なクエリなので､ この辺にしておきます｡ 

29
00:02:07,090 --> 00:02:12,490
マルチマッチクエリで使用できる型は他にもありますが､ すぐにかなり高度なものになってしまいます｡ 

30
00:02:12,490 --> 00:02:15,970
そこで､ この講義にドキュメントへのリンクを添付することにします｡ 

31
00:02:16,330 --> 00:02:20,920
Elasticsearchを使い始めたばかりでは､ 型を変更することは一般的ではありません｡ 

32
00:02:20,920 --> 00:02:26,230
ですから､ この講座の時点では､ これらのタイプに時間をかけて､ あまり技術的なことは言いたくないのです｡

33
00:02:26,680 --> 00:02:28,450
とにかく､ その話はもういい｡ 

34
00:02:28,480 --> 00:02:33,370
ここまでで､ ドキュメント内の複数のフィールドを検索する方法をご覧いただき､ 内部でどのように動作しているかを少しお話しましたが､

35
00:02:33,370 --> 00:02:37,480
今回の講義でお伝えしたかったことは以上です｡
