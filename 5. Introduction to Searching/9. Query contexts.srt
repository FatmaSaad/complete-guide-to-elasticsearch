1
00:00:01,020 --> 00:00:22,530
クエリクラスは､ クエリコンテキストとフィルタコンテキストの2つの異なるコンテキストで実行することができます｡

2
00:00:23,010 --> 00:00:29,730
Elasticsearchは､ そもそも文書が一致するかどうかを判断しますが､ 関連スコアも計算されます｡

3
00:00:30,090 --> 00:00:35,400
これは､ クエリオブジェクトの中に項クエリ句を入れ子にしているため､ これまで見てきたような状態になっています｡ 

4
00:00:35,550 --> 00:00:43,450
なぜそのようにしたかというと､ クエリ句を追加するときに､ フィルタコンテキスト内でクエリ句を追加できる場所がもう一つあるからです｡

5
00:00:43,470 --> 00:00:50,040
フィルタコンテキスト内で､ Elasticsearchにこのクエリ句にマッチするドキュメントを要求します｡  e. クエリ句にマッチしない文書は､

6
00:00:50,040 --> 00:00:53,490
結果の一部にはなりません｡

7
00:00:53,880 --> 00:00:59,190
その部分はクエリコンテキストと同じですが､ 重要な違いは､ フィルタリングコンテキストでは､

8
00:00:59,190 --> 00:01:03,090
Elasticsearchは関連スコアを計算しないことです｡

9
00:01:03,300 --> 00:01:08,340
それは､ 文書が一致するかしないかのプール評価だからだ｡ 

10
00:01:08,610 --> 00:01:13,450
もしそうなら､ それは結果の一部であるべきで､ そうでないならフィルターではないはずです｡ 

11
00:01:13,470 --> 00:01:18,750
コンテキストは､ 日付やステータスフィールドなどのデータをフィルタリングするためによく使われます｡ 

12
00:01:18,780 --> 00:01:24,960
例えば､ 1ヶ月以上前に追加された商品で､ ステータスが「未公開」になっているものを見つけることができます｡ 

13
00:01:25,320 --> 00:01:30,900
つまり､ クエリコンテキストとフィルタコンテキストの違いは､ クエリコンテキスト内にクエリ句を追加した場合､

14
00:01:30,900 --> 00:01:36,720
関連性スコアが計算されるが､ フィルタコンテキストではそうならないことである｡

15
00:01:37,080 --> 00:01:39,900
では､ どのコンテキストにクエリ句を追加すればいいのでしょうか？

16
00:01:40,200 --> 00:01:46,050
結局のところ､ 照会された損失が一致する文書の関連スコアに影響を与えるかどうかということになる｡

17
00:01:46,500 --> 00:01:53,730
その場合は､ クエリコンテキスト内にクエリ句を追加してください｡  e. を､ 今まで見てきたクエリオブジェクトの中に入れることができます｡

18
00:01:54,240 --> 00:01:58,950
例えば､ タイトルフィールドにサラダという言葉が含まれる文書を検索する場合です｡ 

19
00:01:59,190 --> 00:02:03,900
用語が複数回出現する文書をより関連性が高く､ 他の関連性要因もすべて考慮させたい場合は､

20
00:02:03,900 --> 00:02:08,460
クエリコンテキストを利用するようにします｡

21
00:02:08,790 --> 00:02:16,260
もし､ あるサラダを含む文書を､ その一致度に関係なくマッチさせたいだけなら､ フィルタコンテキストを使えばいい｡

22
00:02:16,530 --> 00:02:23,070
その理由は､ どうせ必要ないのであれば､ 関連するスコアを計算しない方が効率が良いに決まっているからです｡

23
00:02:23,430 --> 00:02:26,700
そのうえで､ Elasticsearchはフィルタをキャッシュすることができます｡ 

24
00:02:27,210 --> 00:02:32,970
フィルタの使い方については後ほど説明しますが､ 今はこの簡単な経験則を覚えておいてください｡

25
00:02:33,210 --> 00:02:37,740
クエリ句が関連性に影響する場合は､ クエリコンテキストに追加する｡ 

26
00:02:37,770 --> 00:02:40,050
それ以外の場合は､ コンテキストをフィルタリングするために使用されます｡ 
